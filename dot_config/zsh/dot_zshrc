# { Helpers
  function is_cursor_agent() {
    [[ -n $CURSOR_AGENT ]] && return 0 || return 1
  }

  function is_fnm_initialized() {
    [[ -n "$FNM_MULTISHELL_PATH" ]] && return 0 || return 1
  }
# }

# { Reference: https://github.com/romkatv/powerlevel10k/blob/master/README.md#how-do-i-initialize-direnv-when-using-instant-prompt
  command_exists direnv && emulate zsh -c "$(direnv export zsh)"
# }

# Enable Powerlevel10k instant prompt. Should stay close to the top of ~/.zshrc.
# Initialization code that may require console input (password prompts, [y/n]
# confirmations, etc.) must go above this block; everything else may go below.
is_cursor_agent || file_readable_then_source "${XDG_CACHE_HOME:-$HOME/.cache}/p10k-instant-prompt-${(%):-%n}.zsh"

# { Zsh
  # set HISTFILE and HISTSIZE and SAVEHIST again because /etc/zshrc overwrites them.
  file_readable_then_source "${ZDOTDIR}/setup-history.zsh"
# }

# { Editor
  command_exists nvim && export EDITOR="nvim"
# }

# { Man
  command_exists col && command_exists bat && export MANPAGER='zsh -c "col -bx | bat -pl man"'
# }

# { Zsh
  # Zsh vi mode config
  # Must before oh-my-zsh.zsh
  is_cursor_agent || file_readable_then_source "${ZDOTDIR}/zvm-config.zsh"

  # Oh my zsh
  file_readable_then_source "${ZDOTDIR}/oh-my-zsh.zsh"

  file_readable_then_source "${ZDOTDIR}/functions.zsh"
  file_readable_then_source "${ZDOTDIR}/aliases.zsh"
  file_readable_then_source "${ZDOTDIR}/tmutil-auto-exclude.zsh"
# }

# { Cli
  # Zoxide
  command_exists zoxide && eval "$(zoxide init zsh)"

  # Fzf
  is_cursor_agent && file_readable_then_source "${XDG_CONFIG_HOME}/fzf.zsh" \
  || zvm_after_init_commands+=("file_readable_then_source ${XDG_CONFIG_HOME}/fzf.zsh")

  # Atuin
  command_exists atuin && eval "$(atuin init zsh --disable-up-arrow --disable-ctrl-r)"
  is_cursor_agent && file_readable_then_source "${XDG_CONFIG_HOME}/fzf-atuin.zsh" \
  || zvm_after_init_commands+=("file_readable_then_source ${XDG_CONFIG_HOME}/fzf-atuin.zsh")

  # Fzf-tab
  is_cursor_agent && file_readable_then_source "${XDG_CONFIG_HOME}/fzf-tab.zsh" \
  || zvm_after_init_commands+=("file_readable_then_source ${XDG_CONFIG_HOME}/fzf-tab.zsh")
# }

# { Pgp
  export GPG_TTY="${TTY}"
# }

# { Fnm
  command_exists fnm && ! is_fnm_initialized && eval "$(fnm env --shell zsh)"
# }

# { Pyenv
  command_exists pyenv && eval "$(pyenv init -)"
# }

# { Goenv
  command_exists goenv && eval "$(goenv init -)"
# }

# { Jenv
  command_exists jenv && eval "$(jenv init -)"
# }

# { Direnv
  command_exists direnv && emulate zsh -c "$(direnv hook zsh)"
# }

# Ensure that $USER_LOCAL_BIN has the highest priority in $PATH
path=("${USER_LOCAL_BIN}" $path)

# To customize prompt, run `p10k configure` or edit $ZDOTDIR/p10k.zsh.
is_cursor_agent || file_readable_then_source "${ZDOTDIR}/p10k.zsh"
is_cursor_agent || file_readable_then_source "${ZDOTDIR}/p10k-fnm.zsh"

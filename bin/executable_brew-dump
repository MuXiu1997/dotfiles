#!/usr/bin/env python
import subprocess
import os

Brewfile = os.path.join(os.path.expanduser('~'), '.Brewfile')

mas_id_list = [
    '1176895641',  # Spark
    '1443749478',  # WPS Office
    '497799835',  # Xcode
]

env = os.environ
env['HOMEBREW_NO_AUTO_UPDATE'] = 'true'
cmd = subprocess.Popen(
    ['brew', 'bundle', 'dump', '--describe', '--file=-'],
    stdout=subprocess.PIPE,
    env=env,
)

stdout, _ = cmd.communicate()

output = stdout.decode()
output = '\n'.join([
    l for l in output.splitlines() if
    not (l.startswith('mas'))
    or (l.startswith('mas') and any([l.endswith(mas_id) for mas_id in mas_id_list]))
])

with open(Brewfile, 'w') as fp:
    fp.write(output)

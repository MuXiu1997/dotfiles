{{- if (eq .chezmoi.os "darwin") -}}
#!/usr/bin/env bash

set -euo pipefail

# Source the shell library
source {{ joinPath .chezmoi.sourceDir ".chezmoiscripts" ".lib.sh" | quote }}

configure_darwin_settings() {
  { # Keyboard Settings - ğŸ‡¨ğŸ‡³é”®ç›˜è®¾ç½®
    # Set initial key repeat delay (15 = 225ms) - ğŸ‡¨ğŸ‡³è®¾ç½®æŒ‰é”®é‡å¤åˆå§‹å»¶è¿Ÿï¼ˆ15 = 225æ¯«ç§’ï¼‰
    defaults write NSGlobalDomain InitialKeyRepeat -int 15  
    # Set key repeat rate (2 = 30ms) - ğŸ‡¨ğŸ‡³è®¾ç½®æŒ‰é”®é‡å¤é€Ÿç‡ï¼ˆ2 = 30æ¯«ç§’ï¼‰
    defaults write NSGlobalDomain KeyRepeat -int 2
    # Disable press and hold for accented characters - ğŸ‡¨ğŸ‡³ç¦ç”¨é•¿æŒ‰æ˜¾ç¤ºé‡éŸ³å­—ç¬¦
    defaults write NSGlobalDomain ApplePressAndHoldEnabled -bool false
  }

  { # Interface Behavior Settings - ğŸ‡¨ğŸ‡³ç•Œé¢è¡Œä¸ºè®¾ç½®
    # Disable minimize on double-click title bar - ğŸ‡¨ğŸ‡³ç¦ç”¨åŒå‡»æ ‡é¢˜æ æœ€å°åŒ–
    defaults write NSGlobalDomain AppleMiniaturizeOnDoubleClick -bool false
  }

  { # Text Input Settings - ğŸ‡¨ğŸ‡³æ–‡æœ¬è¾“å…¥è®¾ç½®
    # Disable automatic capitalization - ğŸ‡¨ğŸ‡³ç¦ç”¨è‡ªåŠ¨å¤§å†™
    defaults write NSGlobalDomain NSAutomaticCapitalizationEnabled -bool false
    # Disable automatic period substitution - ğŸ‡¨ğŸ‡³ç¦ç”¨è‡ªåŠ¨å¥å·æ›¿æ¢
    defaults write NSGlobalDomain NSAutomaticPeriodSubstitutionEnabled -bool false
    # Disable automatic spelling correction - ğŸ‡¨ğŸ‡³ç¦ç”¨è‡ªåŠ¨æ‹¼å†™çº æ­£
    defaults write NSGlobalDomain NSAutomaticSpellingCorrectionEnabled -bool false
  }

  { # System Behavior Optimization - ğŸ‡¨ğŸ‡³ç³»ç»Ÿè¡Œä¸ºä¼˜åŒ–
    # Enable spring loading for directories - ğŸ‡¨ğŸ‡³å¯ç”¨æ–‡ä»¶å¤¹å¼¹ç°§åŠ è½½
    defaults write NSGlobalDomain com.apple.springing.enabled -bool true
    # Set spring loading delay to 0.3 seconds - ğŸ‡¨ğŸ‡³è®¾ç½®å¼¹ç°§åŠ è½½å»¶è¿Ÿä¸º0.3ç§’
    defaults write NSGlobalDomain com.apple.springing.delay -float 0.3
    # Speed up window resize animations - ğŸ‡¨ğŸ‡³åŠ å¿«çª—å£è°ƒæ•´å¤§å°åŠ¨ç”»
    defaults write NSGlobalDomain NSWindowResizeTime -float 0.001
    # Show all file extensions - ğŸ‡¨ğŸ‡³æ˜¾ç¤ºæ‰€æœ‰æ–‡ä»¶æ‰©å±•å
    defaults write NSGlobalDomain AppleShowAllExtensions -bool true
  }

  { # Keyboard Navigation Settings - ğŸ‡¨ğŸ‡³é”®ç›˜å¯¼èˆªè®¾ç½®
    # Enable full keyboard access for all controls - ğŸ‡¨ğŸ‡³å¯ç”¨å…¨é”®ç›˜è®¿é—®æ‰€æœ‰æ§ä»¶
    defaults write NSGlobalDomain AppleKeyboardUIMode -int 3
  }

  { # Built-in Trackpad Settings - ğŸ‡¨ğŸ‡³å†…ç½®è§¦æ§æ¿è®¾ç½®
    # Enable tap to click on built-in trackpad - ğŸ‡¨ğŸ‡³å¯ç”¨å†…ç½®è§¦æ§æ¿è½»ç‚¹ç‚¹å‡»
    defaults write com.apple.AppleMultitouchTrackpad Clicking -bool true
    # Enable three finger drag on built-in trackpad - ğŸ‡¨ğŸ‡³å¯ç”¨å†…ç½®è§¦æ§æ¿ä¸‰æŒ‡æ‹–æ‹½
    defaults write com.apple.AppleMultitouchTrackpad TrackpadThreeFingerDrag -bool true
    # Enable two finger double tap gesture on built-in trackpad - ğŸ‡¨ğŸ‡³å¯ç”¨å†…ç½®è§¦æ§æ¿åŒæŒ‡åŒå‡»æ‰‹åŠ¿
    defaults write com.apple.AppleMultitouchTrackpad TrackpadTwoFingerDoubleTapGesture -bool true
    # Set two finger swipe from right edge gesture on built-in trackpad - ğŸ‡¨ğŸ‡³è®¾ç½®å†…ç½®è§¦æ§æ¿å³è¾¹ç¼˜åŒæŒ‡æ»‘åŠ¨æ‰‹åŠ¿
    defaults write com.apple.AppleMultitouchTrackpad TrackpadTwoFingerFromRightEdgeSwipeGesture -int 3
  }

  { # Bluetooth Trackpad Settings - ğŸ‡¨ğŸ‡³è“ç‰™è§¦æ§æ¿è®¾ç½®
    # Enable tap to click on Bluetooth trackpad - ğŸ‡¨ğŸ‡³å¯ç”¨è“ç‰™è§¦æ§æ¿è½»ç‚¹ç‚¹å‡»
    defaults write com.apple.driver.AppleBluetoothMultitouch.trackpad Clicking -bool true
    # Enable three finger drag on Bluetooth trackpad - ğŸ‡¨ğŸ‡³å¯ç”¨è“ç‰™è§¦æ§æ¿ä¸‰æŒ‡æ‹–æ‹½
    defaults write com.apple.driver.AppleBluetoothMultitouch.trackpad TrackpadThreeFingerDrag -bool true
    # Enable two finger double tap gesture on Bluetooth trackpad - ğŸ‡¨ğŸ‡³å¯ç”¨è“ç‰™è§¦æ§æ¿åŒæŒ‡åŒå‡»æ‰‹åŠ¿
    defaults write com.apple.driver.AppleBluetoothMultitouch.trackpad TrackpadTwoFingerDoubleTapGesture -bool true
    # Set two finger swipe from right edge gesture on Bluetooth trackpad - ğŸ‡¨ğŸ‡³è®¾ç½®è“ç‰™è§¦æ§æ¿å³è¾¹ç¼˜åŒæŒ‡æ»‘åŠ¨æ‰‹åŠ¿
    defaults write com.apple.driver.AppleBluetoothMultitouch.trackpad TrackpadTwoFingerFromRightEdgeSwipeGesture -int 3
  }

  { # Force Touch and Global Mouse Settings - ğŸ‡¨ğŸ‡³Force Touch å’Œå…¨å±€é¼ æ ‡è®¾ç½®
    # Enable Force Touch and haptic feedback - ğŸ‡¨ğŸ‡³å¯ç”¨Force Touchå’Œè§¦è§‰åé¦ˆ
    defaults write NSGlobalDomain com.apple.trackpad.forceClick -bool true
    # Enable tap to click for mouse - ğŸ‡¨ğŸ‡³å¯ç”¨é¼ æ ‡è½»ç‚¹ç‚¹å‡»
    defaults write NSGlobalDomain com.apple.mouse.tapBehavior -int 1
  }

  { # Multi-touch Mouse Settings - ğŸ‡¨ğŸ‡³å¤šç‚¹è§¦æ§é¼ æ ‡è®¾ç½®
    # Set two finger double tap gesture for Apple mouse - ğŸ‡¨ğŸ‡³è®¾ç½®è‹¹æœé¼ æ ‡åŒæŒ‡åŒå‡»æ‰‹åŠ¿
    defaults write com.apple.AppleMultitouchMouse MouseTwoFingerDoubleTapGesture -int 3
    # Set two finger double tap gesture for Bluetooth mouse - ğŸ‡¨ğŸ‡³è®¾ç½®è“ç‰™é¼ æ ‡åŒæŒ‡åŒå‡»æ‰‹åŠ¿
    defaults write com.apple.driver.AppleBluetoothMultitouch.mouse MouseTwoFingerDoubleTapGesture -int 3
  }

  { # Siri Menu Bar Settings - ğŸ‡¨ğŸ‡³Siri èœå•æ è®¾ç½®
    # Hide Siri from menu bar - ğŸ‡¨ğŸ‡³éšè—èœå•æ ä¸­çš„Siri
    defaults write com.apple.Siri StatusMenuVisible -bool false
  }

  { # Menu Bar Clock Settings - ğŸ‡¨ğŸ‡³èœå•æ æ—¶é’Ÿè®¾ç½®
    # Use analog clock in menu bar - ğŸ‡¨ğŸ‡³ä½¿ç”¨æ¨¡æ‹Ÿæ—¶é’Ÿæ˜¾ç¤º
    defaults write com.apple.menuextra.clock IsAnalog -bool true
    # Show AM/PM in menu bar clock - ğŸ‡¨ğŸ‡³åœ¨èœå•æ æ—¶é’Ÿæ˜¾ç¤ºä¸Šåˆ/ä¸‹åˆ
    defaults write com.apple.menuextra.clock ShowAMPM -bool true
    # Hide date in menu bar clock - ğŸ‡¨ğŸ‡³éšè—èœå•æ æ—¶é’Ÿä¸­çš„æ—¥æœŸ
    defaults write com.apple.menuextra.clock ShowDate -int 0
    # Show day of week in menu bar clock - ğŸ‡¨ğŸ‡³åœ¨èœå•æ æ—¶é’Ÿæ˜¾ç¤ºæ˜ŸæœŸ
    defaults write com.apple.menuextra.clock ShowDayOfWeek -bool true
  }

  { # Finder Interface Settings - ğŸ‡¨ğŸ‡³Finder ç•Œé¢è®¾ç½®
    # Show status bar in Finder - ğŸ‡¨ğŸ‡³åœ¨Finderä¸­æ˜¾ç¤ºçŠ¶æ€æ 
    defaults write com.apple.finder ShowStatusBar -bool true
    # Show path bar in Finder - ğŸ‡¨ğŸ‡³åœ¨Finderä¸­æ˜¾ç¤ºè·¯å¾„æ 
    defaults write com.apple.finder ShowPathbar -bool true
    # Show sidebar in Finder - ğŸ‡¨ğŸ‡³åœ¨Finderä¸­æ˜¾ç¤ºä¾§è¾¹æ 
    defaults write com.apple.finder ShowSidebar -bool true
  }

  { # Finder Advanced Features - ğŸ‡¨ğŸ‡³Finder é«˜çº§åŠŸèƒ½
    # Show full POSIX path in Finder title bar - ğŸ‡¨ğŸ‡³åœ¨Finderæ ‡é¢˜æ æ˜¾ç¤ºå®Œæ•´POSIXè·¯å¾„
    defaults write com.apple.finder _FXShowPosixPathInTitle -bool true
    # Enable text selection in Quick Look - ğŸ‡¨ğŸ‡³å¯ç”¨Quick Lookä¸­çš„æ–‡æœ¬é€‰æ‹©
    defaults write com.apple.finder QLEnableTextSelection -bool true
    # Add quit menu item to Finder - ğŸ‡¨ğŸ‡³ä¸ºFinderæ·»åŠ é€€å‡ºèœå•é¡¹
    defaults write com.apple.finder QuitMenuItem -bool true
  }

  { # Desktop Icon Display Settings - ğŸ‡¨ğŸ‡³æ¡Œé¢å›¾æ ‡æ˜¾ç¤ºè®¾ç½®
    # Show external hard drives on desktop - ğŸ‡¨ğŸ‡³åœ¨æ¡Œé¢æ˜¾ç¤ºå¤–ç½®ç¡¬ç›˜
    defaults write com.apple.finder ShowExternalHardDrivesOnDesktop -bool true
    # Hide internal hard drives on desktop - ğŸ‡¨ğŸ‡³éšè—æ¡Œé¢ä¸Šçš„å†…ç½®ç¡¬ç›˜
    defaults write com.apple.finder ShowHardDrivesOnDesktop -bool false
    # Show removable media on desktop - ğŸ‡¨ğŸ‡³åœ¨æ¡Œé¢æ˜¾ç¤ºå¯ç§»åŠ¨åª’ä½“
    defaults write com.apple.finder ShowRemovableMediaOnDesktop -bool true
    # Hide mounted servers on desktop - ğŸ‡¨ğŸ‡³éšè—æ¡Œé¢ä¸Šçš„å·²æŒ‚è½½æœåŠ¡å™¨
    defaults write com.apple.finder ShowMountedServersOnDesktop -bool false
  }

  { # Sidebar Section Disclosure States - ğŸ‡¨ğŸ‡³ä¾§è¾¹æ å„éƒ¨åˆ†å±•å¼€çŠ¶æ€
    # Expand devices section in Finder sidebar - ğŸ‡¨ğŸ‡³å±•å¼€Finderä¾§è¾¹æ è®¾å¤‡éƒ¨åˆ†
    defaults write com.apple.finder SidebarDevicesSectionDisclosedState -bool true
    # Expand places section in Finder sidebar - ğŸ‡¨ğŸ‡³å±•å¼€Finderä¾§è¾¹æ ä½ç½®éƒ¨åˆ†
    defaults write com.apple.finder SidebarPlacesSectionDisclosedState -bool true
    # Expand tags section in Finder sidebar - ğŸ‡¨ğŸ‡³å±•å¼€Finderä¾§è¾¹æ æ ‡ç­¾éƒ¨åˆ†
    defaults write com.apple.finder SidebarTagsSctionDisclosedState -bool true
    # Expand iCloud Drive section in Finder sidebar - ğŸ‡¨ğŸ‡³å±•å¼€Finderä¾§è¾¹æ iCloud Driveéƒ¨åˆ†
    defaults write com.apple.finder SidebariCloudDriveSectionDisclosedState -bool true
  }

  { # iCloud Related Settings - ğŸ‡¨ğŸ‡³iCloud ç›¸å…³è®¾ç½®
    # Show iCloud sign-in status in Finder sidebar - ğŸ‡¨ğŸ‡³åœ¨Finderä¾§è¾¹æ æ˜¾ç¤ºiCloudç™»å½•çŠ¶æ€
    defaults write com.apple.finder SidebarShowingSignedIntoiCloud -bool true
    # Hide iCloud Desktop in Finder sidebar - ğŸ‡¨ğŸ‡³éšè—Finderä¾§è¾¹æ ä¸­çš„iCloudæ¡Œé¢
    defaults write com.apple.finder SidebarShowingiCloudDesktop -bool false
  }

  { # Restart Related Services to Apply Settings - ğŸ‡¨ğŸ‡³é‡å¯ç›¸å…³æœåŠ¡ä½¿è®¾ç½®ç”Ÿæ•ˆ
    # Restart SystemUIServer to apply menu bar changes - ğŸ‡¨ğŸ‡³é‡å¯SystemUIServerä»¥åº”ç”¨èœå•æ æ›´æ”¹
    killall SystemUIServer 2>/dev/null || true
    # Restart Finder to apply Finder settings - ğŸ‡¨ğŸ‡³é‡å¯Finderä»¥åº”ç”¨Finderè®¾ç½®
    killall Finder 2>/dev/null || true

    # Run dock setup script - ğŸ‡¨ğŸ‡³è¿è¡Œdockè®¾ç½®è„šæœ¬
    "$HOME/.local/bin/setup-dock"
  }
}

main() {
  log_header "Configuring macOS System Settings"

  if ! configure_darwin_settings; then
    log_error "Failed to configure Darwin settings, aborting"
    exit 1
  fi

  log_success "macOS system configuration completed successfully!"
}

main
{{- end }}
